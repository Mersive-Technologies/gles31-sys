name: Test-Build
on: [push]
jobs:
  Build-Andrid:
    runs-on: ubuntu-latest
    steps:
      - run: echo "üéâ The job was automatically triggered by a ${{ github.event_name }} event."
      - run: echo "üêß This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      - run: echo "üîé The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
      - name: Check out repository code
        uses: actions/checkout@v2
      - run: echo "üí° The ${{ github.repository }} repository has been cloned to the runner."
      - run: echo "üñ•Ô∏è The workflow is now ready to test your code on the runner."
      - name: List files in the repository
        run: |
          ls ${{ github.workspace }}
      - run: echo "üçè This job's status is ${{ job.status }}."
      - name: Setup
        run: |
          pwd # /home/runner/work/gles31-sys/gles31-sys
          whoami # runner
          sudo apt update
          sudo apt install -y curl
      - name: InstallRust
        run: |
          curl https://sh.rustup.rs -sSf | sh -s -- -y --default-toolchain none --no-modify-path
          export PATH=$PATH:$HOME/.cargo/bin
          rustup install 1.58.1
          rustup target add --toolchain 1.58.1 aarch64-linux-android
          cargo --version
      - name: InstallAndroidTools
        run: |
          export ANDROID_SDK_ROOT=/home/runner/.android/sdk
          export ANDROID_HOME="${ANDROID_SDK_ROOT}"
          export PATH="${ANDROID_SDK_ROOT}/emulator:${ANDROID_SDK_ROOT}/platform-tools:${ANDROID_SDK_ROOT}/cmdline-tools/tools/bin:${PATH}"
          mkdir -p ${ANDROID_SDK_ROOT}
          curl https://dl.google.com/android/repository/commandlinetools-linux-6858069_latest.zip ${ANDROID_SDK_ROOT}/cmdline-tools.zip
          cd ${ANDROID_SDK_ROOT}
          pwd
          ls -lha
          unzip cmdline-tools.zip
          mv cmdline-tools tools
          mkdir -p cmdline-tools
          mv tools cmdline-tools
          cd -
          yes | sdkmanager --licenses
          sdkmanager emulator platform-tools
          sdkmanager "sources;android-22" "platforms;android-22" "sources;android-25" "platforms;android-25"
          sdkmanager "build-tools;30.0.3" "cmake;3.10.2.4988404" "ndk;22.0.7026061"
